## RH Telegram Export Plugin

Плагин для отправки данных о гонках в Telegram во время мероприятий.

### Возможности

+ Уведомления о старте и финише гонки
+ Отправка времени кругов во время гонки
+ Результаты гонки с настраиваемым форматом
+ Список пилотов (все или только с назначенными каналами)
+ Список групп (хитов)
+ Результаты мероприятия
+ Мониторинг напряжения батареи и оповещения

### Установка

1. Скачайте архив плагина, распакуйте и переместите папку `rh_telegram_export` в `\src\server\plugins\`

2. Выполните команду в виртуальном окружении RH:
   ```
   pip install -r requirements.txt
   ```

3. Перезапустите RotorHazard

### Создание бота

1. Напишите @BotFather в Telegram: `/newbot`
2. Следуйте инструкциям для создания бота
3. Скопируйте API токен (пример: `123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11`)
4. Добавьте бота в канал/группу с правами администратора

> **ВНИМАНИЕ:** Перед экспортом базы данных обязательно очистите поле с токеном!

### Настройка

Перейдите на вкладку "Run" и найдите раздел "Telegram export".

#### Настройки подключения

| Поле | Описание |
|------|----------|
| **Telegram API token** | Токен бота от @BotFather |
| **Channel @username or id** | Канал: `@channel_name`, Группа: `-100xxxxxxxxxx` |
| **Thread id** | ID топика для каналов с топиками (опционально) |

#### Автоматическая отправка (чекбоксы)

| Опция | Описание |
|-------|----------|
| **Auto send lap time** | Отправлять время кругов во время гонки |
| **Auto send race results** | Отправлять результаты после сохранения кругов |
| **Send pilots with assigned channels** | Показывать только пилотов с назначенным каналом |
| **Send the race start and finish** | Отправлять уведомления о старте/финише гонки |

#### Мониторинг батареи

| Опция | Описание |
|-------|----------|
| **Enable battery voltage alert** | Включить периодический мониторинг батареи |
| **Battery voltage threshold (V)** | Минимальное напряжение для оповещения (по умолчанию: 12V) |
| **Battery check interval (sec)** | Интервал проверки напряжения (по умолчанию: 30 сек) |

#### Настройки результатов

| Опция | Описание |
|-------|----------|
| **Results message text** | Шаблон результатов. Доступные плейсхолдеры: `{lp_best}`, `{lp_avg}`, `{lps_num}`, `{lps_consecutives}`, `{lps_total_time}` |
| **Sort results by** | Сортировка: лучший круг / время гонки / consecutives |

### Кнопки

| Кнопка | Описание |
|--------|----------|
| **Send all heats** | Отправить список всех групп с пилотами |
| **Send results** | Отправить результаты последней гонки |
| **Send all pilots** | Отправить список пилотов |
| **Send event results** | Отправить общие результаты мероприятия |
| **Send battery status** | Отправить текущее напряжение батареи в Telegram |

### Интерфейс

![interface](imgs/interface.png)
